/**
 * skylark-ajaxfy-router - An Elegant HTML5 Routing Framework.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.6-beta
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(t,e){var r=e.define,n=e.require,i="function"==typeof r&&r.amd,a=!i&&"undefined"!=typeof exports;if(!i&&!r){var o={};r=e.define=function(t,e,r){"function"==typeof r?(o[t]={factory:r,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var r=e.split("/"),n=t.split("/");r.pop();for(var i=0;i<n.length;i++)"."!=n[i]&&(".."==n[i]?r.pop():r.push(n[i]));return r.join("/")}(e,t)}),resolved:!1,exports:null},n(t)):o[t]={factory:null,resolved:!0,exports:r}},n=e.require=function(t){if(!o.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var r=o[t];if(!r.resolved){var i=[];r.deps.forEach(function(t){i.push(n(t))}),r.exports=r.factory.apply(e,i)||null,r.resolved=!0}return r.exports}}if(!r)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,e){t("skylark-ajaxfy-router/routing",["skylark-langx/skylark"],function(t){return t.attach("fw.routing",{})}),t("skylark-ajaxfy-router/Route",["skylark-langx/langx","./routing"],function(t,e){var r=t.Evented.inherit({klassName:"Route",init:function(e,r){var n=(r=t.mixin({},r)).pathto||"",i=n,a=i.match(/\:([a-zA-Z0-9_]+)/g);null!==a?(a=a.map(function(t){return t.substring(1)}),i=i.replace(/\:([a-zA-Z0-9_]+)/g,"(.*?)")):a=[],i="*"===i?"(.*)":i.replace("/","\\/"),this._setting=r,this.name=e,this.pathto=n,this.paramNames=a,this.params=i,this.regex=new RegExp("^"+i+"$","");var o=this;["entering","entered","exiting","exited"].forEach(function(e){t.isFunction(r[e])&&o.on(e,r[e])})},enter:function(e,r){if(r){var n=this._entering(e),i=this;return t.Deferred.when(n).then(function(){var t=createEvent("entering",{route:i,result:!0});return i.trigger(t),t.result})}return this._entered(e),this.trigger(createEvent("entered",t.safeMixin({route:this},e))),this},exit:function(e,r){if(r){var n=this._exiting(e);if(!n)return!1;var i=createEvent("exiting",{route:this,result:!0});return this.trigger(i),i.result}return this._exited(e),this.trigger(createEvent("exited",t.safeMixin({route:this},e))),this},match:function(t){var e=this.paramNames,r=t.indexOf("?"),t=~r?t.slice(0,r):decodeURIComponent(t),n=this.regex.exec(t);if(!n)return!1;for(var i={},a=1,o=n.length;a<o;++a){var u=e[a-1],s=decodeURIComponent(n[a]);i[u]=s}return i},path:function(t){var e=this.pathto;return t&&(e=e.replace(/:([a-zA-Z0-9_]+)/g,function(e,r){return t[r]})),e},_entering:function(t){return!0},_entered:function(t){return!0},_exiting:function(t){return!0},_exited:function(t){return!0}});return e.Route=r}),t("skylark-ajaxfy-router/router",["skylark-langx/langx","./routing","./Route"],function(t,e,r){var n,i,a,o,u={},s={},f=new t.Evented;function h(e,r){var n=new CustomEvent(e,r);return t.safeMixin(n,r)}function p(e){if(n){var r=n.route.exit({path:n.path,params:n.params},!0);if(!r)return}if(i=n,!(n=e).route){var a=l(n.path);n.route=a.route,n.params=a.params}var o=n.route.enter({force:n.force,path:n.path,params:n.params},!0);t.Deferred.when(o).then(function(){f.trigger(h("routing",{current:n,previous:i})),n.route.enter({path:n.path,params:n.params},!1),i&&i.route.exit({path:i.path,params:i.params},!1),f.trigger(h("routed",{current:n,previous:i}))})}function c(t,e){if(!e&&n&&n.path==t)return!1;var r=l(t);if(r)if(r.path=t,g.useHistoryApi){var i={force:e,path:t};window.history.pushState(i,document.title,(a+t).replace("//","/")),window.dispatchEvent(h("popstate",{state:i}))}else if(g.useHashbang){var o="#!"+t;window.location.hash!==o?window.location.hash=o:p(r)}else p(r);return!0}function l(e,r){var n=!1;return!r&&(n=s[e])?n:(t.each(u,function(t,r){var i=r.match(e);return!i||(n={route:r,params:i},!1)}),n&&!r&&(s[e]=n),n)}function d(e){if(!t.isDefined(e))return t.mixin({},u);for(var r in e)u[r]=new g.Route(r,e[r])}var g=function(){return g};return t.mixin(g,{Route:r,current:function(){return n},go:c,map:l,hub:function(){return f},off:function(){f.off.apply(f,arguments)},on:function(){f.on.apply(f,arguments)},one:function(){f.one.apply(f,arguments)},path:function(t,e){var r,n=u[t];n&&(r=n.path(e));return r},previous:function(){return i},baseUrl:function(e){return t.isDefined(e)?(a=e,this):a},homePath:function(e){return t.isDefined(e)?(o=e,this):o},route:function(e,r){if(t.isDefined(r)){var n={};return n[e]=r,d(n),this}return u[e]},routes:d,start:function(){null==g.useHashbang&&null==g.useHistoryApi&&(window.location.host&&window.history.pushState?g.useHistoryApi=!0:g.useHashbang=!0);var t="";g.useHistoryApi?(t=window.location.pathname,void 0===a&&(a=t.replace(/\/$/,"")),t=t.replace(a,"")||o||"/"):t=g.useHashbang&&(window.location.hash.replace("#!","")||o)||"/";t.startsWith("/")||(t="/"+t);g.useHistoryApi?window.addEventListener("popstate",function(t){t.state&&p(t.state),t.preventDefault()}):g.useHashbang&&window.addEventListener("hashchange",function(t){p({path:window.location.hash.replace(/^#!/,"")}),t.preventDefault()});c(t)},trigger:function(t){return f.trigger(t),this},useHistoryApi:null,useHashbang:null}),skylark.router=g}),t("skylark-ajaxfy-router/main",["skylark-langx/skylark","./router"],function(t){return t}),t("skylark-ajaxfy-router",["skylark-ajaxfy-router/main"],function(t){return t})}(r),!i){var u=n("skylark-langx/skylark");a?module.exports=u:e.skylarkjs=u}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-ajaxfy-router.js.map
