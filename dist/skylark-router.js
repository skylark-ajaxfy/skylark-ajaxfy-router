/**
 * skylark-router - An Elegant HTML5 Routing Framework.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(t,e){var r=e.define,n=e.require,i="function"==typeof r&&r.amd,a=!i&&"undefined"!=typeof exports;if(!r)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(t(r,n),i)r(["skylark-router"],function(t){return t});else{var u=n("skylark-router");a?exports=u:e.skylark.router=u}}(function(t,e){t("skylark-router/router",["skylark-utils/skylark","skylark-utils/langx","skylark-utils/browser","skylark-utils/datax","skylark-utils/eventer","skylark-utils/async"],function(t,e,r,n,i,a){function u(){return k}function o(t){if(y){var e=y.route.exit({path:y.path,params:y.params},!0);if(!e)return}if(y=k,k=t,!k.route){var r=h(k.path);k.route=r.route,k.params=r.params}var n=k.route.enter({path:k.path,params:k.params},!0);a.Deferred.when(n).then(function(){i.trigger(_,"routing",{current:k,previous:y}),k.route.enter({path:k.path,params:k.params},!1),y&&y.route.exit({path:y.path,params:y.params},!1),i.trigger(_,"routed",{current:k,previous:y})})}function s(t,e){if(!e&&k&&k.path==t)return!1;var r=h(t);if(r)if(r.path=t,D.useHistoryApi){var n={path:t};window.history.pushState(n,document.title,(w+t).replace("//","/")),i.trigger(window,i.create("popstate",{state:n}))}else if(D.useHashbang){var a="#!"+t;window.location.hash!==a?window.location.hash=a:o(r)}else o(r);return!0}function h(t,r){var n=!1;return!r&&(n=H[t])?n:(e.each(b,function(e,r){var i=r.match(t);return!i||(n={route:r,params:i},!1)}),n&&!r&&(H[t]=n),n)}function f(t,e){var r,n=b[t];return n&&(r=n.path(e)),r}function c(){return y}function p(t){return e.isDefined(t)?(w=t,this):w}function l(){return _}function g(t){return e.isDefined(t)?(x=t,this):x}function d(t,r){if(e.isDefined(r)){var n={};return n[t]=r,m(n),this}return b[t]}function m(t){if(!e.isDefined(t))return e.mixin({},b);for(var r in t)b[r]=new D.Route(r,t[r])}function v(){null==D.useHashbang&&null==D.useHistoryApi&&(window.location.host?D.useHistoryApi=!0:D.useHashbang=!0);var t;D.useHistoryApi?(t=window.location.pathname,void 0===w&&(w=t.replace(/\/$/,"")),t=t.replace(w,"")||x||"/"):t=D.useHashbang?window.location.hash.replace("#!","")||x||"/":"/",i.on(document.body,"click","a[href]",function(t){var r=t.currentTarget,a=n.attr(r,"href");"#"!=a&&a&&e.isSameOrigin(r.href)&&0===a.indexOf(w)&&(a=a.substr(w.length),i.stop(t),a=a.replace("#!",""),s(a))}),D.useHistoryApi?i.on(window,"popstate",function(t){t.state&&o(t.state),i.stop(t)}):D.useHashbang&&i.on(window,"hashchange",function(t){o({path:window.location.hash.replace(/^#!/,"")}),i.stop(t)}),s(t)}var k,y,w,x,b={},H={},_=new e.Evented,A=e.Evented.inherit({klassName:"Route",init:function(t,r){r=e.mixin({},r);var n=r.pathto||"",i=n,a=i.match(/\:([a-zA-Z0-9_]+)/g);null!==a?(a=a.map(function(t){return t.substring(1)}),i=i.replace(/\:([a-zA-Z0-9_]+)/g,"(.*?)")):a=[],i="*"===i?"(.*)":i.replace("/","\\/"),this._setting=r,this.name=t,this.pathto=n,this.paramNames=a,this.params=i,this.regex=new RegExp("^"+i+"$","");var u=this;["entering","entered","exiting","exited"].forEach(function(t){e.isFunction(r[t])&&u.on(t,r[t])})},enter:function(t,r){if(r){var n=this._entering(t);return a.Deferred.when(n).then(function(){var t=i.create("entering",{route:this,result:!0});return i.trigger(this,t),t.result})}return this._entered(t),i.trigger(this,"entered",e.safeMixin({route:this},t)),this},exit:function(t,r){if(r){var n=this._exiting(t);if(!n)return!1;var a=i.create("exiting",{route:this,result:!0});return i.trigger(this,a),a.result}return this._exited(t),i.trigger(this,"exited",e.safeMixin({route:this},t)),this},match:function(t){var e=this.paramNames,r=t.indexOf("?"),t=~r?t.slice(0,r):decodeURIComponent(t),n=this.regex.exec(t);if(!n)return!1;for(var i={},a=1,u=n.length;a<u;++a){var o=e[a-1],s=decodeURIComponent(n[a]);i[o]=s}return i},path:function(t){var e=this.pathto;return t&&(e=e.replace(/:([a-zA-Z0-9_]+)/g,function(e,r){return t[r]})),e},_entering:function(t){return!0},_entered:function(t){return!0},_exiting:function(t){return!0},_exited:function(t){return!0}}),D=function(){return D};return e.mixin(D,{Route:A,current:u,go:s,map:h,hub:l,off:function(){_.off.apply(_,arguments)},on:function(){_.on.apply(_,arguments)},one:function(){_.one.apply(_,arguments)},path:f,previous:c,baseUrl:p,homePath:g,route:d,routes:m,start:v,trigger:function(t,e){return i.trigger(_,t,e),this},useHistoryApi:null,useHashbang:null}),t.router=D}),t("skylark-router",["skylark-router/router"],function(t){return t})},this);
//# sourceMappingURL=sourcemaps/skylark-router.js.map
