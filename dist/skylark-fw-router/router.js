/**
 * skylark-fw-router - An Elegant HTML5 Routing Framework.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.6-beta
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx/langx"],function(t,e){var n,r,i,a,u={},o={},s=new e.Evented;function h(t,n){var r=new CustomEvent(t,n);return e.safeMixin(r,n)}var f=e.Evented.inherit({klassName:"Route",init:function(t,n){var r=(n=e.mixin({},n)).pathto||"",i=r,a=i.match(/\:([a-zA-Z0-9_]+)/g);null!==a?(a=a.map(function(t){return t.substring(1)}),i=i.replace(/\:([a-zA-Z0-9_]+)/g,"(.*?)")):a=[],i="*"===i?"(.*)":i.replace("/","\\/"),this._setting=n,this.name=t,this.pathto=r,this.paramNames=a,this.params=i,this.regex=new RegExp("^"+i+"$","");var u=this;["entering","entered","exiting","exited"].forEach(function(t){e.isFunction(n[t])&&u.on(t,n[t])})},enter:function(t,n){if(n){var r=this._entering(t),i=this;return e.Deferred.when(r).then(function(){var t=h("entering",{route:i,result:!0});return i.trigger(t),t.result})}return this._entered(t),this.trigger(h("entered",e.safeMixin({route:this},t))),this},exit:function(t,n){if(n){if(!this._exiting(t))return!1;var r=h("exiting",{route:this,result:!0});return this.trigger(r),r.result}return this._exited(t),this.trigger(h("exited",e.safeMixin({route:this},t))),this},match:function(t){var e=this.paramNames,n=t.indexOf("?"),r=(t=~n?t.slice(0,n):decodeURIComponent(t),this.regex.exec(t));if(!r)return!1;for(var i={},a=1,u=r.length;a<u;++a){var o=e[a-1],s=decodeURIComponent(r[a]);i[o]=s}return i},path:function(t){var e=this.pathto;return t&&(e=e.replace(/:([a-zA-Z0-9_]+)/g,function(e,n){return t[n]})),e},_entering:function(t){return!0},_entered:function(t){return!0},_exiting:function(t){return!0},_exited:function(t){return!0}});function p(t){if(n&&!n.route.exit({path:n.path,params:n.params},!0))return;if(r=n,!(n=t).route){var i=l(n.path);n.route=i.route,n.params=i.params}var a=n.route.enter({force:n.force,path:n.path,params:n.params},!0);e.Deferred.when(a).then(function(){s.trigger(h("routing",{current:n,previous:r})),n.route.enter({path:n.path,params:n.params},!1),r&&r.route.exit({path:r.path,params:r.params},!1),s.trigger(h("routed",{current:n,previous:r}))})}function c(t,e){if(!e&&n&&n.path==t)return!1;var r=l(t);if(r)if(r.path=t,d.useHistoryApi){var a={force:e,path:t};window.history.pushState(a,document.title,(i+t).replace("//","/")),window.dispatchEvent(h("popstate",{state:a}))}else if(d.useHashbang){var u="#!"+t;window.location.hash!==u?window.location.hash=u:p(r)}else p(r);return!0}function l(t,n){var r=!1;return!n&&(r=o[t])?r:(e.each(u,function(e,n){var i=n.match(t);return!i||(r={route:n,params:i},!1)}),r&&!n&&(o[t]=r),r)}function g(t){if(!e.isDefined(t))return e.mixin({},u);for(var n in t)u[n]=new d.Route(n,t[n])}var d=function(){return d};return e.mixin(d,{Route:f,current:function(){return n},go:c,map:l,hub:function(){return s},off:function(){s.off.apply(s,arguments)},on:function(){s.on.apply(s,arguments)},one:function(){s.one.apply(s,arguments)},path:function(t,e){var n,r=u[t];return r&&(n=r.path(e)),n},previous:function(){return r},baseUrl:function(t){return e.isDefined(t)?(i=t,this):i},homePath:function(t){return e.isDefined(t)?(a=t,this):a},route:function(t,n){if(e.isDefined(n)){var r={};return r[t]=n,g(r),this}return u[t]},routes:g,start:function(){null==d.useHashbang&&null==d.useHistoryApi&&(window.location.host&&window.history.pushState?d.useHistoryApi=!0:d.useHashbang=!0);var t="";d.useHistoryApi?(t=window.location.pathname,void 0===i&&(i=t.replace(/\/$/,"")),t=t.replace(i,"")||a||"/"):t=d.useHashbang&&(window.location.hash.replace("#!","")||a)||"/",t.startsWith("/")||(t="/"+t),d.useHistoryApi?window.addEventListener("popstate",function(t){t.state&&p(t.state),t.preventDefault()}):d.useHashbang&&window.addEventListener("hashchange",function(t){p({path:window.location.hash.replace(/^#!/,"")}),t.preventDefault()}),c(t)},trigger:function(t){return s.trigger(t),this},useHistoryApi:null,useHashbang:null}),t.router=d});
//# sourceMappingURL=sourcemaps/router.js.map
