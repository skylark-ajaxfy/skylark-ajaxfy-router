/**
 * skylark-fw-router - An Elegant HTML5 Routing Framework.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.6-beta
 * @link www.skylarkjs.org
 * @license MIT
 */
!function(t,e){var r=e.define,n=e.require,i="function"==typeof r&&r.amd,a=!i&&"undefined"!=typeof exports;if(!i&&!r){var o={};r=e.define=function(t,e,r){"function"==typeof r?(o[t]={factory:r,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var r=e.split("/"),n=t.split("/");r.pop();for(var i=0;i<n.length;i++)"."!=n[i]&&(".."==n[i]?r.pop():r.push(n[i]));return r.join("/")}(e,t)}),resolved:!1,exports:null},n(t)):o[t]={factory:null,resolved:!0,exports:r}},n=e.require=function(t){if(!o.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var r=o[t];if(!r.resolved){var i=[];r.deps.forEach(function(t){i.push(n(t))}),r.exports=r.factory.apply(e,i)||null,r.resolved=!0}return r.exports}}if(!r)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,e){t("skylark-fw-router/router",["skylark-langx/skylark","skylark-langx/langx"],function(t,e){var r,n,i,a,o={},u={},s=new e.Evented;function f(t,r){var n=new CustomEvent(t,r);return e.safeMixin(n,r)}var h=e.Evented.inherit({klassName:"Route",init:function(t,r){var n=(r=e.mixin({},r)).pathto||"",i=n,a=i.match(/\:([a-zA-Z0-9_]+)/g);null!==a?(a=a.map(function(t){return t.substring(1)}),i=i.replace(/\:([a-zA-Z0-9_]+)/g,"(.*?)")):a=[],i="*"===i?"(.*)":i.replace("/","\\/"),this._setting=r,this.name=t,this.pathto=n,this.paramNames=a,this.params=i,this.regex=new RegExp("^"+i+"$","");var o=this;["entering","entered","exiting","exited"].forEach(function(t){e.isFunction(r[t])&&o.on(t,r[t])})},enter:function(t,r){if(r){var n=this._entering(t),i=this;return e.Deferred.when(n).then(function(){var t=f("entering",{route:i,result:!0});return i.trigger(t),t.result})}return this._entered(t),this.trigger(f("entered",e.safeMixin({route:this},t))),this},exit:function(t,r){if(r){var n=this._exiting(t);if(!n)return!1;var i=f("exiting",{route:this,result:!0});return this.trigger(i),i.result}return this._exited(t),this.trigger(f("exited",e.safeMixin({route:this},t))),this},match:function(t){var e=this.paramNames,r=t.indexOf("?"),t=~r?t.slice(0,r):decodeURIComponent(t),n=this.regex.exec(t);if(!n)return!1;for(var i={},a=1,o=n.length;a<o;++a){var u=e[a-1],s=decodeURIComponent(n[a]);i[u]=s}return i},path:function(t){var e=this.pathto;return t&&(e=e.replace(/:([a-zA-Z0-9_]+)/g,function(e,r){return t[r]})),e},_entering:function(t){return!0},_entered:function(t){return!0},_exiting:function(t){return!0},_exited:function(t){return!0}});function p(t){if(r){var i=r.route.exit({path:r.path,params:r.params},!0);if(!i)return}if(n=r,!(r=t).route){var a=l(r.path);r.route=a.route,r.params=a.params}var o=r.route.enter({force:r.force,path:r.path,params:r.params},!0);e.Deferred.when(o).then(function(){s.trigger(f("routing",{current:r,previous:n})),r.route.enter({path:r.path,params:r.params},!1),n&&n.route.exit({path:n.path,params:n.params},!1),s.trigger(f("routed",{current:r,previous:n}))})}function c(t,e){if(!e&&r&&r.path==t)return!1;var n=l(t);if(n)if(n.path=t,v.useHistoryApi){var a={force:e,path:t};window.history.pushState(a,document.title,(i+t).replace("//","/")),window.dispatchEvent(f("popstate",{state:a}))}else if(v.useHashbang){var o="#!"+t;window.location.hash!==o?window.location.hash=o:p(n)}else p(n);return!0}function l(t,r){var n=!1;return!r&&(n=u[t])?n:(e.each(o,function(e,r){var i=r.match(t);return!i||(n={route:r,params:i},!1)}),n&&!r&&(u[t]=n),n)}function d(t){if(!e.isDefined(t))return e.mixin({},o);for(var r in t)o[r]=new v.Route(r,t[r])}var v=function(){return v};return e.mixin(v,{Route:h,current:function(){return r},go:c,map:l,hub:function(){return s},off:function(){s.off.apply(s,arguments)},on:function(){s.on.apply(s,arguments)},one:function(){s.one.apply(s,arguments)},path:function(t,e){var r,n=o[t];n&&(r=n.path(e));return r},previous:function(){return n},baseUrl:function(t){return e.isDefined(t)?(i=t,this):i},homePath:function(t){return e.isDefined(t)?(a=t,this):a},route:function(t,r){if(e.isDefined(r)){var n={};return n[t]=r,d(n),this}return o[t]},routes:d,start:function(){null==v.useHashbang&&null==v.useHistoryApi&&(window.location.host&&window.history.pushState?v.useHistoryApi=!0:v.useHashbang=!0);var t="";v.useHistoryApi?(t=window.location.pathname,void 0===i&&(i=t.replace(/\/$/,"")),t=t.replace(i,"")||a||"/"):t=v.useHashbang&&(window.location.hash.replace("#!","")||a)||"/";t.startsWith("/")||(t="/"+t);v.useHistoryApi?window.addEventListener("popstate",function(t){t.state&&p(t.state),t.preventDefault()}):v.useHashbang&&window.addEventListener("hashchange",function(t){p({path:window.location.hash.replace(/^#!/,"")}),t.preventDefault()});c(t)},trigger:function(t){return s.trigger(t),this},useHistoryApi:null,useHashbang:null}),t.router=v}),t("skylark-fw-router/main",["skylark-langx/skylark","./router"],function(t){return t}),t("skylark-fw-router",["skylark-fw-router/main"],function(t){return t})}(r),!i){var u=n("skylark-langx/skylark");a?module.exports=u:e.skylarkjs=u}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-fw-router.js.map
