/**
 * skylark-ajaxfy-router - An Elegant HTML5 Routing Framework.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.6-beta
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx/langx","./routers","./Route"],function(t,e,n){var r,a,i,o,u={},s={},p=new t.Evented;function h(e,n){var r=new CustomEvent(e,n);return t.safeMixin(r,n)}function f(e){if(r&&!r.route.exit({path:r.path,params:r.params},!0))return;if(a=r,!(r=e).route){var n=l(r.path);r.route=n.route,r.params=n.params}var i=r.route.enter({force:r.force,path:r.path,params:r.params},!0);t.Deferred.when(i).then(function(){p.trigger(h("routing",{current:r,previous:a})),r.route.enter({path:r.path,params:r.params},!1),a&&a.route.exit({path:a.path,params:a.params},!1),p.trigger(h("routed",{current:r,previous:a}))})}function c(t,e){if(!e&&r&&r.path==t)return!1;var n=l(t);if(n)if(n.path=t,w.useHistoryApi){var a={force:e,path:t};window.history.pushState(a,document.title,(i+t).replace("//","/")),window.dispatchEvent(h("popstate",{state:a}))}else if(w.useHashbang){var o="#!"+t;window.location.hash!==o?window.location.hash=o:f(n)}else f(n);return!0}function l(e,n){var r=!1;return!n&&(r=s[e])?r:(t.each(u,function(t,n){var a=n.match(e);return!a||(r={route:n,params:a},!1)}),r&&!n&&(s[e]=r),r)}function d(e){if(!t.isDefined(e))return t.mixin({},u);for(var n in e)u[n]=new w.Route(n,e[n])}var w=function(){return w};return t.mixin(w,{Route:n,current:function(){return r},go:c,map:l,hub:function(){return p},off:function(){p.off.apply(p,arguments)},on:function(){p.on.apply(p,arguments)},one:function(){p.one.apply(p,arguments)},path:function(t,e){var n,r=u[t];return r&&(n=r.path(e)),n},previous:function(){return a},baseUrl:function(e){return t.isDefined(e)?(i=e,this):i},homePath:function(e){return t.isDefined(e)?(o=e,this):o},route:function(e,n){if(t.isDefined(n)){var r={};return r[e]=n,d(r),this}return u[e]},routes:d,start:function(){null==w.useHashbang&&null==w.useHistoryApi&&(window.location.host&&window.history.pushState?w.useHistoryApi=!0:w.useHashbang=!0);var t="";w.useHistoryApi?(t=window.location.pathname,void 0===i&&(i=t.replace(/\/$/,"")),t=t.replace(i,"")||o||"/"):t=w.useHashbang&&(window.location.hash.replace("#!","")||o)||"/",t.startsWith("/")||(t="/"+t),w.useHistoryApi?window.addEventListener("popstate",function(t){t.state&&f(t.state),t.preventDefault()}):w.useHashbang&&window.addEventListener("hashchange",function(t){f({path:window.location.hash.replace(/^#!/,"")}),t.preventDefault()}),c(t)},trigger:function(t){return p.trigger(t),this},useHistoryApi:null,useHashbang:null}),skylark.router=w});
//# sourceMappingURL=sourcemaps/Router.js.map
