/**
 * skylark-ajaxfy-router - An Elegant HTML5 Routing Framework.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.6-beta
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx/langx","./routing","./Route"],function(t,n,e){var r,a,i,o,u={},s={},p=new t.Evented;function h(n,e){var r=new CustomEvent(n,e);return t.safeMixin(r,e)}function f(n){if(r&&!r.route.exit({path:r.path,params:r.params},!0))return;if(a=r,!(r=n).route){var e=l(r.path);r.route=e.route,r.params=e.params}var i=r.route.enter({force:r.force,path:r.path,params:r.params},!0);t.Deferred.when(i).then(function(){p.trigger(h("routing",{current:r,previous:a})),r.route.enter({path:r.path,params:r.params},!1),a&&a.route.exit({path:a.path,params:a.params},!1),p.trigger(h("routed",{current:r,previous:a}))})}function c(t,n){if(!n&&r&&r.path==t)return!1;var e=l(t);if(e)if(e.path=t,w.useHistoryApi){var a={force:n,path:t};window.history.pushState(a,document.title,(i+t).replace("//","/")),window.dispatchEvent(h("popstate",{state:a}))}else if(w.useHashbang){var o="#!"+t;window.location.hash!==o?window.location.hash=o:f(e)}else f(e);return!0}function l(n,e){var r=!1;return!e&&(r=s[n])?r:(t.each(u,function(t,e){var a=e.match(n);return!a||(r={route:e,params:a},!1)}),r&&!e&&(s[n]=r),r)}function d(n){if(!t.isDefined(n))return t.mixin({},u);for(var e in n)u[e]=new w.Route(e,n[e])}var w=function(){return w};return t.mixin(w,{Route:e,current:function(){return r},go:c,map:l,hub:function(){return p},off:function(){p.off.apply(p,arguments)},on:function(){p.on.apply(p,arguments)},one:function(){p.one.apply(p,arguments)},path:function(t,n){var e,r=u[t];return r&&(e=r.path(n)),e},previous:function(){return a},baseUrl:function(n){return t.isDefined(n)?(i=n,this):i},homePath:function(n){return t.isDefined(n)?(o=n,this):o},route:function(n,e){if(t.isDefined(e)){var r={};return r[n]=e,d(r),this}return u[n]},routes:d,start:function(){null==w.useHashbang&&null==w.useHistoryApi&&(window.location.host&&window.history.pushState?w.useHistoryApi=!0:w.useHashbang=!0);var t="";w.useHistoryApi?(t=window.location.pathname,void 0===i&&(i=t.replace(/\/$/,"")),t=t.replace(i,"")||o||"/"):t=w.useHashbang&&(window.location.hash.replace("#!","")||o)||"/",t.startsWith("/")||(t="/"+t),w.useHistoryApi?window.addEventListener("popstate",function(t){t.state&&f(t.state),t.preventDefault()}):w.useHashbang&&window.addEventListener("hashchange",function(t){f({path:window.location.hash.replace(/^#!/,"")}),t.preventDefault()}),c(t)},trigger:function(t){return p.trigger(t),this},useHistoryApi:null,useHashbang:null}),skylark.router=w});
//# sourceMappingURL=sourcemaps/Router.js.map
