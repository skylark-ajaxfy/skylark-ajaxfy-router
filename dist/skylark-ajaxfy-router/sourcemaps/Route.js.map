{"version":3,"sources":["Route.js"],"names":["define","langx","routers","Route","Evented","inherit","klassName","init","name","setting","pathto","mixin","pattern","paramNames","match","map","paramName","substring","replace","this","_setting","params","regex","RegExp","self","forEach","eventName","isFunction","on","enter","ctx","query","r","_entering","Deferred","when","then","e","createEvent","route","result","trigger","_entered","safeMixin","exit","_exiting","_exited","path","names","x","indexOf","m","slice","decodeURIComponent","exec","i","len","length","val"],"mappings":";;;;;;;AAAAA,QACC,sBACA,aACC,SAASC,EAAMC,GACb,IAAIC,EAAQF,EAAMG,QAAQC,SACtBC,UAAW,QACXC,KAAM,SAASC,EAAMC,GAEjB,IAAIC,GADJD,EAAUR,EAAMU,SAAUF,IACLC,QAAU,GAC3BE,EAAUF,EACVG,EAAaD,EAAQE,MAAM,sBACZ,OAAfD,GACAA,EAAaA,EAAWE,IAAI,SAASC,GACjC,OAAOA,EAAUC,UAAU,KAE/BL,EAAUA,EAAQM,QAAQ,qBAAsB,UAEhDL,KAGAD,EADY,MAAZA,EACU,OAEAA,EAAQM,QAAQ,IAAK,OAGnCC,KAAKC,SAAWX,EAChBU,KAAKX,KAAOA,EACZW,KAAKT,OAASA,EACdS,KAAKN,WAAaA,EAClBM,KAAKE,OAAST,EACdO,KAAKG,MAAQ,IAAIC,OAAO,IAAMX,EAAU,IAAK,IAE7C,IAAIY,EAAOL,MACV,WAAY,UAAW,UAAW,UAAUM,QAAQ,SAASC,GACtDzB,EAAM0B,WAAWlB,EAAQiB,KACzBF,EAAKI,GAAGF,EAAWjB,EAAQiB,OAKvCG,MAAO,SAASC,EAAIC,GAChB,GAAIA,EAAO,CACP,IAAIC,EAAIb,KAAKc,UAAUH,GACnBN,EAAOL,KAEX,OAAOlB,EAAMiC,SAASC,KAAKH,GAAGI,KAAK,WAC/B,IAAIC,EAAIC,YAAY,YAChBC,MAAOf,EACPgB,QAAQ,IAKZ,OAFAhB,EAAKiB,QAAQJ,GAENA,EAAEG,SAQb,OALArB,KAAKuB,SAASZ,GAEdX,KAAKsB,QAAQH,YAAY,UAAWrC,EAAM0C,WACtCJ,MAAOpB,MACRW,KACIX,MAIfyB,KAAM,SAASd,EAAKC,GAChB,GAAIA,EAAO,CAEP,IADSZ,KAAK0B,SAASf,GAEnB,OAAO,EAGX,IAAIO,EAAIC,YAAY,WAChBC,MAAOpB,KACPqB,QAAQ,IAKZ,OAFArB,KAAKsB,QAAQJ,GAENA,EAAEG,OAOT,OALArB,KAAK2B,QAAQhB,GACbX,KAAKsB,QAAQH,YAAY,SAAUrC,EAAM0C,WACrCJ,MAAOpB,MACRW,KAEIX,MAIfL,MAAO,SAASiC,GACZ,IAAIC,EAAQ7B,KAAKN,WACboC,EAAIF,EAAKG,QAAQ,KAEjBC,GADAJ,GAAQE,EAAIF,EAAKK,MAAM,EAAGH,GAAKI,mBAAmBN,GAC9C5B,KAAKG,MAAMgC,KAAKP,IAExB,IAAKI,EACD,OAAO,EAIX,IADA,IAAI9B,KACKkC,EAAI,EAAGC,EAAML,EAAEM,OAAQF,EAAIC,IAAOD,EAAG,CAC1C,IAAI/C,EAAOwC,EAAMO,EAAI,GACjBG,EAAML,mBAAmBF,EAAEI,IAC/BlC,EAAOb,GAAQkD,EAGnB,OAAOrC,GAGX0B,KAAM,SAAS1B,GACX,IAAI0B,EAAO5B,KAAKT,OAMhB,OALIW,IACA0B,EAAOA,EAAK7B,QAAQ,oBAAqB,SAASJ,EAAOE,GACrD,OAAOK,EAAOL,MAGf+B,GAGXd,UAAW,SAASH,GAChB,OAAO,GAEXY,SAAU,SAASZ,GACf,OAAO,GAEXe,SAAU,SAASf,GACf,OAAO,GAEXgB,QAAS,SAAShB,GACd,OAAO,KAIlB,OAAO5B,EAAQC,MAAQA","file":"../Route.js","sourcesContent":["define([\r\n\t\"skylark-langx/langx\",\r\n\t\"./routers\"\r\n],function(langx,routers){\r\n    var Route = langx.Evented.inherit({\r\n        klassName: \"Route\",\r\n        init: function(name, setting) {\r\n            setting = langx.mixin({}, setting);\r\n            var pathto = setting.pathto || \"\",\r\n                pattern = pathto,\r\n                paramNames = pattern.match(/\\:([a-zA-Z0-9_]+)/g);\r\n            if (paramNames !== null) {\r\n                paramNames = paramNames.map(function(paramName) {\r\n                    return paramName.substring(1);\r\n                });\r\n                pattern = pattern.replace(/\\:([a-zA-Z0-9_]+)/g, '(.*?)');\r\n            } else {\r\n                paramNames = [];\r\n            }\r\n            if (pattern === \"*\") {\r\n                pattern = \"(.*)\";\r\n            } else {\r\n                pattern = pattern.replace(\"/\", \"\\\\/\");\r\n            }\r\n\r\n            this._setting = setting;\r\n            this.name = name;\r\n            this.pathto = pathto;\r\n            this.paramNames = paramNames;\r\n            this.params = pattern;\r\n            this.regex = new RegExp(\"^\" + pattern + \"$\", \"\");\r\n\r\n            var self = this;\r\n            [\"entering\", \"entered\", \"exiting\", \"exited\"].forEach(function(eventName) {\r\n                if (langx.isFunction(setting[eventName])) {\r\n                    self.on(eventName, setting[eventName]);\r\n                }\r\n            });\r\n        },\r\n\r\n        enter: function(ctx,query) {\r\n            if (query) {\r\n                var r = this._entering(ctx),\r\n                    self = this;\r\n\r\n                return langx.Deferred.when(r).then(function(){\r\n                    var e = createEvent(\"entering\", {\r\n                        route: self,\r\n                        result: true\r\n                    });\r\n\r\n                    self.trigger(e);\r\n\r\n                    return e.result;\r\n                });\r\n            } else {\r\n                this._entered(ctx);\r\n\r\n                this.trigger(createEvent(\"entered\", langx.safeMixin({\r\n                    route: this\r\n                }, ctx)));\r\n                return this;\r\n            }\r\n        },\r\n\r\n        exit: function(ctx, query) {\r\n            if (query) {\r\n                var ok = this._exiting(ctx);\r\n                if (!ok) {\r\n                    return false;\r\n                }\r\n\r\n                var e = createEvent(\"exiting\", {\r\n                    route: this,\r\n                    result: true\r\n                });\r\n\r\n                this.trigger(e);\r\n\r\n                return e.result;\r\n            } else {\r\n                this._exited(ctx);\r\n                this.trigger(createEvent(\"exited\", langx.safeMixin({\r\n                    route: this\r\n                }, ctx)));\r\n\r\n                return this;\r\n            }\r\n        },\r\n\r\n        match: function(path) {\r\n            var names = this.paramNames,\r\n                x = path.indexOf('?'),\r\n                path = ~x ? path.slice(0, x) : decodeURIComponent(path),\r\n                m = this.regex.exec(path);\r\n\r\n            if (!m) {\r\n                return false\r\n            };\r\n\r\n            var params = {};\r\n            for (var i = 1, len = m.length; i < len; ++i) {\r\n                var name = names[i - 1],\r\n                    val = decodeURIComponent(m[i]);\r\n                params[name] = val;\r\n            }\r\n\r\n            return params;\r\n        },\r\n\r\n        path: function(params) {\r\n            var path = this.pathto;\r\n            if (params) {\r\n                path = path.replace(/:([a-zA-Z0-9_]+)/g, function(match, paramName) {\r\n                    return params[paramName];\r\n                });\r\n            }\r\n            return path;\r\n        },\r\n\r\n        _entering: function(ctx) {\r\n            return true;\r\n        },\r\n        _entered: function(ctx) {\r\n            return true;\r\n        },\r\n        _exiting: function(ctx) {\r\n            return true;\r\n        },\r\n        _exited: function(ctx) {\r\n            return true;\r\n        },\r\n    });\r\n\r\n\treturn routers.Route = Route;\t\r\n})"]}